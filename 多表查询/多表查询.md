# 多表查询关系

# 多对多
create table student(
id int auto_increment primary key comment'主键ID',
name varchar(10)comment'姓名',
no varchar(10)comment'学号'
)comment'学生表';
insert into student values (null,'黛绮丝','2000100101'),(null,'谢逊','2000100102'),(null,'般天正','2000100103'),(null,'韦一笑','2000100104');

create table course(
    id int auto_increment primary key comment'主键ID',
    name varchar(10)comment'课程名称'
)comment'课程表';
insert into course values (null, 'Java'), (null, 'PHP'),(null , 'MySQL'), (null, 'Hadoop');

create table student_course(
id int auto_increment comment'主键'primary key,
studentid int not null comment'学生ID',
courseid int not null comment'课程ID',
constraint fk_courseid foreign key(courseid) references course (id),
constraint fk_studentid foreign key (studentid) references student (id)
)comment'学生课程中间表';
insert into student_course values (null,1, 1),(null,1,2), (null,1,3), (null, 2,2),(null,2, 3) ,(null, 3,4);

create table tb_user(
id int auto_increment primary key comment'主键ID',
name varchar(10)comment'姓名',
age int comment'年龄',
gender char(1)comment'1:男，2:女',
phone char(11)comment'手机号'
)comment'用户基本信息表';
create table tb_user_edu
(
    id            int auto_increment primary key comment '主键ID',
    degree        varchar(20) comment '学历',
    major         varchar(50) comment '专业',
    primaryschool varchar(50) comment '小学',
    middleschool  varchar(50) comment '中学',
    university    varchar(50) comment '大学',
    userid        int unique comment '用户ID',
    constraint fk_userid foreign key (userid) references tb_user (id)
)comment '用户教育信息表';

insert into tb_user(id, name, age, gender, phone) values
(null,'黄渤',45,'1','18800001111'),
(null,'冰冰',35,'2','18800002222'),
(null,'码云',55,'1','18800008888'),
(null,'李彦宏',50,'1','18800009999');
insert into tb_user_edu(id, degree, major, primaryschool, middleschool, university, userid) values
    (null,'本科','舞蹈','静安区第一小学','静安区第一中学','北京舞蹈学院',1),
    (null,'硕士','表演','朝阳区第一小学','朝阳区第一中学','北京电影学院',2),
    (null,'本科','英语','杭州市第一小学','杭州市第一中学','杭州师范大学',3),
    (null,'本科','应用数学','阳泉第一小学','阳泉区第一中学','清华大学',4);

# 多表查询 --笛卡尔积
select  * from emp,dept where emp.dept_id = dept.id;
# 多表查询 --分类
# 内连接演示--交集
# 1.查询每一个员工的姓名，及关联的部门的名称(隐式内连实现)
select emp.name ,dept.name from emp,dept where emp.dept_id = dept.id;

select e.name ,d.name from emp e,dept d where e.dept_id = d.id;
# 2.查询每一个员工的姓名，及关联的部门的名称(显式内连接实现)
select e.name ,d.name from emp e inner join dept d on e.dept_id = d.id;

select e.name ,d.name from emp e join dept d on e.dept_id = d.id;

# --外连接演示
# 1.查询emp表的所有数据，和对应的部门信息(左外连接)
select e.*,d.name from emp e left outer join dept d on e.dept_id = d.id;

select e.*,d.name from emp e left join dept d on e.dept_id = d.id;
# 2.查询dept表的所有数据，和对应的员工信息(右外连接)
select d.*,e.* from emp e right join dept d on e.dept_id = d.id;

# 自连接 -- 必须起别名
#1.查询员工及其所属领导的名字
select a.name,b.name from emp a ,emp b where  a.managerid = b.id;
# 2.查询所有员工emp及其领导的名字emp:如果员工没有领导，也需要查询出来（外连接）
select a.name '员工',b.name '领导' from emp a  left join emp b on a.managerid = b.id;

# 联合查询 union union all---字段列数和数据类型都要一致，all全部列出会重复
# 将多次查询结果合并起来，形成一个新的查询结果
# 将薪资低了 5000 的员工 和 年龄大了 50 岁的员工全部查询出来,
select * from emp where salary < 10000
union all
select * from emp where age > 50;

select * from emp where salary < 10000
union
select * from emp where age > 50;

# --标量子查询
# --1.查询“销售部”的所有员工信息
select * from emp where dept_id = (select id from dept where name = '销售部');
# --2.查询在“方东白”入职之后的员工信息
select * from emp where entrydate > (select entrydate from emp where name = '方东白');
# --列子查询
# --1、查询“销售部”和“市场部”的所有员工信息
select * from emp where dept_id in(select id from dept where name = '销售部' or name = '市场部');
# --2、查询比财务部所有人工资都高的员工信息
# 查询所有财务部工资
select salary from emp where dept_id  = (select id from dept where name = '财务部');
#
select * from emp where salary > all(select salary from emp where dept_id  = (select id from dept where name = '财务部'));
# 查询比研发部其中任意一人工资高的员工
select * from emp where salary > some(select salary from emp where dept_id  = (select id from dept where name = '研发部'));

# 行子查询
# 1.查询与“张无忌”的薪资及直属领导相同的员工信息;
# --a.查询"张无忌”的薪资及直属领导
select salary,managerid from emp where name ='张无忌';
# --b.查询与“张无忌”的薪资及直属领导相同的员工信息;
select * from emp where salary = 12500 and managerid = 1;

select * from emp where (salary ,managerid) = (select salary,managerid from emp where name ='张无忌');

# 表子查询
# --1.查询与"鹿杖客”，“宋远桥”的职位和薪资相同的员工信息
select job,salary from emp where  name = '鹿杖客' or name = '宋远桥';
select * from emp where (job,salary) in (select job,salary from emp where  name = '鹿杖客' or name = '宋远桥');
# 2.查询入职日期是“2006-01-01”之后的员工信息，及其部门信息
select * from emp where  entrydate > '2006-01-01';
select e.*,d.name from (select * from emp where  entrydate > '2006-01-01') e left join dept d on e.dept_id = d.id;